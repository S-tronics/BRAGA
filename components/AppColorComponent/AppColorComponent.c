/**********************************************************************************************************************/
/**
 * @file        AppColorComponent.c
 *
 * @author      Stijn Vermeersch
 * @date        24.05.2022
 *
 * @brief
 *
 *
 * \n<hr>
 * Copyright (c) 2022, S-tronics BV\n
 * All rights reserved.
 * \n<hr>\n
 */
/**********************************************************************************************************************/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; V E R I F Y    C O N F I G U R A T I O N
;---------------------------------------------------------------------------------------------------------------------*/

/*--------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; I N C L U D E S
;---------------------------------------------------------------------------------------------------------------------*/
#include <stdio.h>
#include <stdint.h>
#include <stddef.h>
#include <string.h>

#include "esp_system.h"
#include "sdkconfig.h"
#include "AppColorComponent.h"

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   D E F I N I T I O N S   A N D   M A C R O S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   T Y P E D E F S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   F U N C T I O N   P R O T O T Y P E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; E X P O R T E D   V A R I A B L E S
;---------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; L O C A L   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------*/
double minimum(double a, double b, double c)
{
    double min = a;
    if (b < min)
    {
        min = b;
    }
    if (c < min)
    {
        min = c;
    }
    return min;
}
/*--------------------------------------------------------------------------------------------------------------------*/

/**********************************************************************************************************************/

/***********************************************************************************************************************
; E X P O R T E D   F U N C T I O N S
;---------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------*/
void AppColor_Init(void)
{
}
/*--------------------------------------------------------------------------------------------------------------------*/
void AppColor_rainbow_cycle(uint8_t *pRed, uint8_t *pGreen, uint8_t *pBlue)
{
    // 255 0 0 => 254 1 0 => 1 254 0 =>
    // 0 255 0 => 0 254 1 => 0 1 254 =>
    // 0 0 255 => 1 0 254 => 254 0 1
    //^

    if ((*pRed == 0) && (*pBlue != 255))
    { // bvb 0 255 0 of 0 253 2 maar niet 0 0 255
        // Verhoog blauw
        *pBlue += 5;
        // Verlaag groen als (>0)
        if (*pGreen > 0)
        {
            *pGreen -= 5;
        }
    }

    else if ((*pGreen == 0) && (*pRed != 255))
    { // situatie bvb 0 0 255 of 2 0 253 maar niet 255 0 0
        // Verhoog Rood
        *pRed += 5;
        // Verlaag Blauw als (>0)
        if (*pBlue > 0)
        {
            *pBlue -= 5;
        }
    }

    else
    { // x x 0
        // Verhoog Groen (als <255)
        if (*pGreen < 255)
        {
            *pGreen += 5;
        }
        // Verlaag Rood (als > 0)
        if (*pRed > 0)
        {
            *pRed -= 5;
        }
    }
}
/*--------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------*/
color_rgbw_t AppColor_rgb_to_rgbw(color_rgb_t rgb)
{

    double whiteValueForRed = ((double)rgb.red) * 255.0 / kWhiteRedChannel;
    double whiteValueForGreen = ((double)rgb.green) * 255.0 / kWhiteGreenChannel;
    double whiteValueForBlue = ((double)rgb.blue) * 255.0 / kWhiteBlueChannel;

    double whiteValue = (double)minimum(whiteValueForRed, whiteValueForGreen, whiteValueForBlue);

    uint8_t Wo = (whiteValue <= 255 ? (uint8_t)whiteValue : 255);

    // The rest of the channels will just be the original value minus the
    // contribution by the white channel.
    uint8_t Ro = (uint8_t)(rgb.red - whiteValue * kWhiteRedChannel / 255);
    uint8_t Go = (uint8_t)(rgb.green - whiteValue * kWhiteGreenChannel / 255);
    uint8_t Bo = (uint8_t)(rgb.blue - whiteValue * kWhiteBlueChannel / 255);

    return (color_rgbw_t){
        .red = Ro,
        .green = Go,
        .blue = Bo,
        .white = Wo};
}

/**********************************************************************************************************************/